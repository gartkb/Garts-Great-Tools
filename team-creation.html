<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>GW2 Team Builder</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f5f5f5;
    }
    .container {
      max-width: 900px;
      margin: auto;
    }
    textarea {
      width: 100%;
      height: 150px;
      margin-bottom: 10px;
      font-family: monospace;
      padding: 8px;
      box-sizing: border-box;
    }
    button {
      padding: 8px 16px;
      margin-bottom: 20px;
      cursor: pointer;
      background: #007BFF;
      color: white;
      border: none;
      border-radius: 4px;
    }
    button:hover {
      background: #0056b3;
    }
    .player-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .player-item {
      background: white;
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 10px;
    }
    .player-name {
      flex: 1;
      min-width: 200px;
      font-weight: bold;
    }
    .player-emojis {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      margin: 0 10px;
      font-size: 20px;
    }
    .role-selector {
      display: flex;
      gap: 6px;
      align-items: center;
    }
    .role-icon {
      width: 36px;
      height: 36px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      border: 1px solid transparent;
      padding: 2px;
      font-size: 24px;
      line-height: 1;
      background: white;
      border-radius: 4px;
    }
    .role-icon.selected {
      border: 2px solid #007BFF;
      background: #e6f2ff;
    }
    .role-icon img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    .group-header {
      font-weight: bold;
      margin-top: 25px;
      margin-bottom: 10px;
      color: #222;
      font-size: 1.1em;
    }
    .group-container {
      margin-bottom: 20px;
      background: #fafafa;
      padding: 12px;
      border-radius: 6px;
      border-left: 3px solid #007BFF;
    }
    .assigned-player {
      padding: 4px 0;
      font-family: monospace;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>‚öîÔ∏è Guild Wars 2 Team Builder</h2>
    <p>Paste your player list below (one per line). Emojis like üöπ, üê•, üî•, üõ°Ô∏è will be auto-detected.</p>

    <textarea id="inputPlayers" placeholder="Example:
1.Swiftwrath.8954 üöπ                              üìß
2.Terror (Spooky.2749) üöπ                         üìß  üê•
3.Zerimar (Eyobayona.8417)                        üìß  üê•
4.dark9174 (Dazaak.9635) üöπ                       üìß  üî•
5.morganah.8214 üë•                                üìß  üî•
6.üí´Gartner Kinderboom.5019                       üìß  üõ°Ô∏è  üî•  üê•  üïµÔ∏è‚Äç‚ôÇÔ∏è
7.üí´SkielaHun.7015                                üìß"></textarea>

    <button onclick="parsePlayers()">Parse Players</button>

    <div id="outputContainer"></div>
  </div>

  <script>
    // Define supported roles: 4 custom icons + 1 text emoji
    const roleIcons = [
      { emoji: 'QuickDPS', img: 'https://cdn.discordapp.com/emojis/1038159940164014090.png' },
      { emoji: 'QuickHeal', img: 'https://cdn.discordapp.com/emojis/1038159941472620655.png' },
      { emoji: 'AlacHeal', img: 'https://cdn.discordapp.com/emojis/1038159938335277140.png' },
      { emoji: 'AlacDPS', img: 'https://cdn.discordapp.com/emojis/1038159937391562843.png' },
      { emoji: 'DPS', text: '‚öîÔ∏è' },
    ];

    // Global state to track assignments (simple version)
    let playerAssignments = [];

    function parsePlayers() {
      const text = document.getElementById('inputPlayers').value.trim();
      const lines = text.split('\n').filter(line => line.trim());

      const container = document.getElementById('outputContainer');
      container.innerHTML = '';
      playerAssignments = [];

      lines.forEach((line, index) => {
        // Clean line and extract name + emojis
        let cleanLine = line.replace(/^\d+\.\s*/, '').trim();
        let name = cleanLine;
        let foundEmojis = [];

        // Extract Unicode emojis (basic support)
        const emojiRegex = /[\p{Emoji_Presentation}\u{1F3FB}-\u{1F3FF}\u{1F9B0}-\u{1F9B3}]/gu;
        const matches = cleanLine.match(emojiRegex);
        if (matches) {
          foundEmojis = matches;
          // Remove emojis from name for cleaner display
          name = cleanLine.replace(emojiRegex, '').replace(/\s+/g, ' ').trim();
        }

        playerAssignments.push({
          id: index,
          name: name,
          emojis: foundEmojis,
          group: 'Group 1',
          selectedRoles: new Set()
        });

        const playerItem = document.createElement('div');
        playerItem.className = 'player-item';

        const nameDiv = document.createElement('div');
        nameDiv.className = 'player-name';
        nameDiv.textContent = name;

        const emojisDiv = document.createElement('div');
        emojisDiv.className = 'player-emojis';
        foundEmojis.forEach(emoji => {
          const span = document.createElement('span');
          span.textContent = emoji;
          emojisDiv.appendChild(span);
        });

        const groupSelect = document.createElement('select');
        ['Group 1', 'Group 2', 'Group 3', 'Group 4'].forEach(group => {
          const opt = document.createElement('option');
          opt.value = group;
          opt.textContent = group;
          if (group === 'Group 1') opt.selected = true;
          groupSelect.appendChild(opt);
        });

        groupSelect.addEventListener('change', (e) => {
          playerAssignments[index].group = e.target.value;
          renderGroups();
        });

        const roleSelector = document.createElement('div');
        roleSelector.className = 'role-selector';

        roleIcons.forEach((role, roleIndex) => {
          const roleElement = document.createElement('span');
          roleElement.className = 'role-icon';
          roleElement.title = role.emoji;

          if (role.text) {
            roleElement.textContent = role.text;
          } else if (role.img) {
            const img = document.createElement('img');
            img.src = role.img;
            img.alt = role.emoji;
            roleElement.appendChild(img);
          }

          roleElement.onclick = function () {
            this.classList.toggle('selected');
            const isSelected = this.classList.contains('selected');
            if (isSelected) {
              playerAssignments[index].selectedRoles.add(role.emoji);
            } else {
              playerAssignments[index].selectedRoles.delete(role.emoji);
            }
            renderGroups();
          };

          roleSelector.appendChild(roleElement);
        });

        playerItem.appendChild(nameDiv);
        playerItem.appendChild(emojisDiv);
        const groupLabel = document.createElement('span');
        groupLabel.textContent = 'Group:';
        playerItem.appendChild(groupLabel);
        playerItem.appendChild(groupSelect);
        playerItem.appendChild(roleSelector);

        container.appendChild(playerItem);
      });

      renderGroups();
    }

    function renderGroups() {
      const groupDisplay = document.getElementById('groupSummary');
      if (groupDisplay) groupDisplay.remove();

      const summaryDiv = document.createElement('div');
      summaryDiv.id = 'groupSummary';

      const groups = {};
      playerAssignments.forEach(p => {
        if (!groups[p.group]) groups[p.group] = [];
        groups[p.group].push(p);
      });

      Object.entries(groups).forEach(([groupName, players]) => {
        if (players.length === 0) return;

        const groupDiv = document.createElement('div');
        groupDiv.className = 'group-container';

        const header = document.createElement('div');
        header.className = 'group-header';
        header.textContent = `${groupName} (${players.length} player${players.length !== 1 ? 's' : ''})`;

        groupDiv.appendChild(header);

        players.forEach(player => {
          const pDiv = document.createElement('div');
          pDiv.className = 'assigned-player';
          const roles = Array.from(player.selectedRoles).join(', ') || 'None';
          pDiv.textContent = `${player.name} ‚Üí Roles: ${roles}`;
          groupDiv.appendChild(pDiv);
        });

        summaryDiv.appendChild(groupDiv);
      });

      document.getElementById('outputContainer').appendChild(summaryDiv);
    }
  </script>
</body>
</html>
